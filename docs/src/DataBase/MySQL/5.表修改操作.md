# MySQL 表结构修改操作指南
## 一、核心语法概览
MySQL 中修改表结构的核心命令是 `ALTER TABLE`，所有对表的调整（如增减字段、修改类型、重命名等）均基于此命令扩展。

基本语法格式：
```sql
ALTER TABLE 表名
[操作1] [操作参数]
[操作2] [操作参数];
```

## 二、常见修改场景及案例
### 1. 新增字段（ADD COLUMN）
用于在表中添加新的列，可指定字段位置（默认在末尾）。

- 语法：
  ```sql
  -- 在表末尾新增字段
  ALTER TABLE 表名 ADD COLUMN 字段名 数据类型 [约束条件];
  -- 在指定字段后新增字段
  ALTER TABLE 表名 ADD COLUMN 字段名 数据类型 [约束条件] AFTER 已存在字段名;
  -- 在表首行新增字段
  ALTER TABLE 表名 ADD COLUMN 字段名 数据类型 [约束条件] FIRST;
  ```

- 示例：
  ```sql
  -- 给 student 表新增 age 字段（int 类型，非空）
  ALTER TABLE student ADD COLUMN age INT NOT NULL;
  -- 给 student 表在 name 字段后新增 email 字段（varchar 类型）
  ALTER TABLE student ADD COLUMN email VARCHAR(50) AFTER name;
  ```

### 2. 修改字段（MODIFY COLUMN / CHANGE COLUMN）
- **MODIFY COLUMN**：仅修改字段的数据类型、约束或位置，不改变字段名。
  - 语法：
    ```sql
    ALTER TABLE 表名 MODIFY COLUMN 字段名 新数据类型 [新约束条件] [字段位置];
    ```
  - 示例：将 student 表的 age 字段改为 tinyint 类型，并允许为空
    ```sql
    ALTER TABLE student MODIFY COLUMN age TINYINT NULL;
    ```

- **CHANGE COLUMN**：可同时修改字段名、数据类型和约束。
  - 语法：
    ```sql
    ALTER TABLE 表名 CHANGE COLUMN 旧字段名 新字段名 新数据类型 [新约束条件];
    ```
  - 示例：将 student 表的 email 字段改名为 mail，类型改为 varchar(100)
    ```sql
    ALTER TABLE student CHANGE COLUMN email mail VARCHAR(100);
    ```

### 3. 删除字段（DROP COLUMN）
用于删除表中不需要的字段，删除后字段数据将永久丢失，需谨慎操作。

- 语法：
  ```sql
  ALTER TABLE 表名 DROP COLUMN 字段名;
  ```

- 示例：删除 student 表的 mail 字段
  ```sql
  ALTER TABLE student DROP COLUMN mail;
  ```

### 4. 重命名表（RENAME TO）
用于修改整个表的名称。

- 语法：
  ```sql
  ALTER TABLE 旧表名 RENAME TO 新表名;
  -- 或使用 RENAME TABLE 命令（效果相同）
  RENAME TABLE 旧表名 TO 新表名;
  ```

- 示例：将 student 表改名为 students
  ```sql
  ALTER TABLE student RENAME TO students;
  ```

### 5. 修改表字符集（DEFAULT CHARACTER SET）
用于统一调整表的字符编码，避免中文乱码问题。

- 语法：
  ```sql
  ALTER TABLE 表名 DEFAULT CHARACTER SET 字符集名称 COLLATE 对应的排序规则;
  ```

- 示例：将 students 表的字符集改为 utf8mb4
  ```sql
  ALTER TABLE students DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
  ```

---

## 三、注意事项
1. **数据安全**：修改表结构前，尤其是删除字段、修改字段类型时，务必先备份表数据（可使用 `CREATE TABLE 备份表名 LIKE 原表名; INSERT INTO 备份表名 SELECT * FROM 原表名;`）。
2. **锁表影响**：在 MySQL 5.6+ 版本中，多数 `ALTER TABLE` 操作采用 Online DDL 模式，不阻塞读写；但部分操作（如修改字段类型）仍可能锁表，需避开业务高峰期执行。
3. **约束检查**：修改字段约束时（如将非空改为允许空），需确保现有数据符合新约束；若存在不符合的数据，修改会失败。

---



## MySQL 表修改操作速查表

| 操作类型         | 核心语法                                                                 | 示例代码                                                                 | 注意事项                                                                 |
|------------------|--------------------------------------------------------------------------|--------------------------------------------------------------------------|--------------------------------------------------------------------------|
| **字段操作**     |                                                                          |                                                                          |                                                                          |
| 新增字段         | ALTER TABLE 表名 ADD COLUMN 字段名 类型 [约束] [AFTER 字段名/FIRST];       | ALTER TABLE student ADD COLUMN age INT NOT NULL AFTER name;              | 非空字段需确保表中无数据或设置默认值                                     |
| 修改字段类型/约束 | ALTER TABLE 表名 MODIFY COLUMN 字段名 新类型 [新约束] [位置];              | ALTER TABLE student MODIFY COLUMN age TINYINT UNSIGNED NULL;             | 缩小长度需确保现有数据不超长                                             |
| 修改字段名+属性  | ALTER TABLE 表名 CHANGE COLUMN 旧字段名 新字段名 新类型 [新约束];          | ALTER TABLE student CHANGE COLUMN age stu_age INT NOT NULL;              | 必须指定新类型（即使与旧类型一致）                                       |
| 删除字段         | ALTER TABLE 表名 DROP COLUMN 字段名;                                      | ALTER TABLE student DROP COLUMN stu_age;                                 | 操作前务必备份数据，不可删除表中唯一字段                                 |
| 调整字段顺序     | ALTER TABLE 表名 MODIFY COLUMN 字段名 类型 [约束] AFTER 目标字段/FIRST;    | ALTER TABLE student MODIFY COLUMN name VARCHAR(50) FIRST;                 | 需完整保留字段原有类型和约束                                             |
| **表名与字符集** |                                                                          |                                                                          |                                                                          |
| 重命名表         | RENAME TABLE 旧表名 TO 新表名; 或 ALTER TABLE 旧表名 RENAME TO 新表名;     | RENAME TABLE student TO t_student;                                       | 需同步更新关联的视图、存储过程                                           |
| 修改表字符集     | ALTER TABLE 表名 DEFAULT CHARACTER SET 字符集 COLLATE 排序规则;             | ALTER TABLE t_student DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci; | 仅影响新字段，旧字段需单独用 MODIFY 修改                                 |
| **索引操作**     |                                                                          |                                                                          |                                                                          |
| 新增普通索引     | ALTER TABLE 表名 ADD INDEX 索引名(字段名); 或 CREATE INDEX 索引名 ON 表名(字段名); | ALTER TABLE t_student ADD INDEX idx_name(name);                          | 索引名可省略，默认格式为 `idx_字段名`                                    |
| 新增唯一索引     | ALTER TABLE 表名 ADD UNIQUE INDEX 索引名(字段名); 或 CREATE UNIQUE INDEX 索引名 ON 表名(字段名); | ALTER TABLE t_student ADD UNIQUE INDEX idx_email(email);                 | 确保字段值无重复，否则创建失败                                           |
| 新增主键索引     | ALTER TABLE 表名 ADD PRIMARY KEY(字段名);                                 | ALTER TABLE t_student ADD PRIMARY KEY(id);                               | 一个表只能有一个主键，且字段需非空                                       |
| 新增联合索引     | ALTER TABLE 表名 ADD INDEX 索引名(字段1, 字段2, ...);                      | ALTER TABLE t_student ADD INDEX idx_name_age(name, age);                 | 遵循“最左前缀原则”，查询需包含左侧字段才会命中索引                       |
| 删除索引         | ALTER TABLE 表名 DROP INDEX 索引名; 或 DROP INDEX 索引名 ON 表名;           | ALTER TABLE t_student DROP INDEX idx_name;                               | 主键索引需用 `DROP PRIMARY KEY`（无需指定索引名）                         |
| 删除主键索引     | ALTER TABLE 表名 DROP PRIMARY KEY;                                        | ALTER TABLE t_student DROP PRIMARY KEY;                                  | 若主键为自增字段，需先取消自增属性（用 MODIFY）再删除                     |


### 索引操作额外说明：
1. **索引名规范**：建议统一前缀（如 `idx_` 普通索引、`uni_` 唯一索引），便于识别和管理。
2. **性能影响**：新增索引会降低写入（INSERT/UPDATE/DELETE）性能，建议仅对查询频繁的字段创建索引。
3. **查看索引**：可通过 `SHOW INDEX FROM 表名;` 查看表中所有索引信息，确认操作效果。
