在 Linux 系统中，**服务（Service）** 是在后台运行、独立于用户交互的长期进程，负责执行核心系统功能（如网络管理、定时任务）或应用程序功能（如 Web 服务、数据库服务）。Linux 服务的管理机制随系统发展不断演进，目前主流的两种管理架构是 **Systemd**（现代系统默认，如 CentOS 7+、Ubuntu 15.04+、Debian 8+）和 **SysVinit**（传统架构，多见于旧系统如 CentOS 6、Ubuntu 14.04）。


## 一、核心概念：服务与进程的关系
服务本质是 “被管理的进程”，其核心特征包括：

+ **后台运行**：无交互式界面，通过终端命令或配置文件控制。
+ **开机自启**：可配置为系统启动时自动加载，无需手动启动。
+ **状态可控**：支持启动（start）、停止（stop）、重启（restart）、重载配置（reload）等操作。
+ **依赖管理**：现代服务管理器（如 Systemd）可自动处理服务间的依赖（如 “数据库服务启动后，再启动 Web 服务”）。


## 二、主流服务管理架构：Systemd（现代 Linux 默认）
`Systemd` 是目前绝大多数 Linux 发行版的默认初始化系统（Init System），取代了传统的 SysVinit，具有**并行启动、依赖管理、日志集成**等优势。其核心是通过 “单元（Unit）” 管理服务、设备、挂载点等，其中服务对应的单元类型为 **.service**。


### 1. Systemd 服务的核心命令
所有操作需通过 `systemctl` 工具执行，部分命令需 `sudo` 权限（管理系统级服务）。

| **命令作用** | **完整命令** | **说明** |
| :--- | :--- | :--- |
| 启动服务 | `sudo systemctl start [服务名]` | 临时启动服务，重启后失效（如 `sudo systemctl start nginx`）。 |
| 停止服务 | `sudo systemctl stop [服务名]` | 临时停止服务，重启后失效（如 `sudo systemctl stop nginx`）。 |
| 重启服务 | `sudo systemctl restart [服务名]` | 停止后重新启动，适用于配置修改后（如 `sudo systemctl restart mysql`）。 |
| 重载配置（不中断服务） | `sudo systemctl reload [服务名]` | 仅重载配置文件，服务不中断（如 `sudo systemctl reload nginx`）。 |
| 查看服务状态 | `systemctl status [服务名]` | 显示服务是否运行、PID、日志片段等（最常用的排障命令）。 |
| 设置开机自启 | `sudo systemctl enable [服务名]` | 永久配置：系统启动时自动启动服务（如 `sudo systemctl enable sshd`）。 |
| 关闭开机自启 | `sudo systemctl disable [服务名]` | 永久取消：系统启动时不自动启动服务。 |
| 查看是否开机自启 | `systemctl is-enabled [服务名]` | 返回 `enabled`（已启用）、`disabled`（已禁用）等状态。 |
| 查看所有已启动的服务 | `systemctl list-units --type=service` | 列出当前活跃的服务单元。 |
| 查看所有服务（含未启动） | `systemctl list-units --type=service --all` | 列出所有服务单元（包括未激活的）。 |


### 2. Systemd 服务的配置文件
服务的行为由配置文件定义，默认路径为：

+ **系统级服务**：`/usr/lib/systemd/system/`（软件安装时自动生成）
+ **用户自定义服务**：`/etc/systemd/system/`（用户手动创建，优先级高于系统级）

配置文件命名格式为 `[服务名].service`（如 `nginx.service`），核心结构如下（以 Nginx 为例）：

```ini
[Unit]
Description=Nginx HTTP Server  # 服务描述
After=network.target remote-fs.target nss-lookup.target  # 启动依赖：网络、远程文件系统等就绪后再启动
Wants=network.target  # 弱依赖：依赖服务未启动也不影响当前服务启动（强依赖用Requires）

[Service]
Type=forking  # 进程类型：forking（后台运行，父进程退出）、simple（前台运行）等
PIDFile=/var/run/nginx.pid  # PID文件路径（Type=forking时需指定）
ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf  # 启动命令
ExecReload=/bin/kill -s HUP $MAINPID  # 重载配置命令（通过HUP信号通知主进程）
ExecStop=/bin/kill -s QUIT $MAINPID  # 停止命令（通过QUIT信号优雅停止）
PrivateTmp=true  # 为服务分配独立的临时目录（安全优化）

[Install]
WantedBy=multi-user.target  # 开机自启的目标级别：多用户模式（无图形界面）
```

修改配置文件后，需执行 `sudo systemctl daemon-reload` 让 Systemd 加载新配置，再重启服务生效。


### 3. Systemd 服务的日志查看
Systemd 集成了日志系统 `journald`，可通过 `journalctl` 查看服务日志（无需单独配置 rsyslog）：

+ 查看指定服务的实时日志：`sudo journalctl -u [服务名] -f`（`-f` 表示 “跟踪日志”，类似 `tail -f`）
+ 查看指定服务的历史日志：`sudo journalctl -u [服务名]`
+ 查看最近 10 行日志：`sudo journalctl -u [服务名] -n 10`
+ 按时间筛选日志：`sudo journalctl -u [服务名] --since "2024-01-01 00:00" --until "2024-01-01 12:00"`


## 三、传统服务管理架构：SysVinit（旧系统兼容）
SysVinit 是早期 Linux 的服务管理架构，依赖 “运行级别（Runlevel）” 和 “启动脚本”，目前仅在旧系统（如 CentOS 6、Ubuntu 14.04）中使用。


### 1. SysVinit 的核心概念：运行级别（Runlevel）
运行级别定义系统的启动状态，不同级别加载不同服务，常见级别如下：

| **运行级别** | **含义（CentOS/RHEL）** | **含义（Ubuntu/Debian）** |
| :--- | :--- | :--- |
| 0 | 关机（halt） | 关机 |
| 1 | 单用户模式（救援模式） | 单用户模式 |
| 2 | 多用户模式（无网络） | 多用户模式（带网络） |
| 3 | 多用户模式（带网络，无图形） | 同级别 2 |
| 4 | 未使用（自定义） | 未使用 |
| 5 | 图形界面模式 | 图形界面模式 |
| 6 | 重启（reboot） | 重启 |


查看当前运行级别：`runlevel`  
切换运行级别：`init [级别]`（如 `init 0` 关机，`init 3` 切换到无图形模式）


### 2. SysVinit 服务的核心命令
通过 `service` 工具管理服务，通过 `chkconfig` 工具配置开机自启：

| **命令作用** | **完整命令** | **说明** |
| :--- | :--- | :--- |
| 启动服务 | `sudo service [服务名] start` | 如 `sudo service httpd start`（httpd 是 Apache 服务名）。 |
| 停止服务 | `sudo service [服务名] stop` | 如 `sudo service mysqld stop`（mysqld 是 MySQL 服务名）。 |
| 重启服务 | `sudo service [服务名] restart` | 如 `sudo service sshd restart`。 |
| 查看服务状态 | `sudo service [服务名] status` | 显示服务是否运行、PID 等。 |
| 设置开机自启 | `sudo chkconfig [服务名] on` | 如 `sudo chkconfig httpd on`（所有运行级别均自启）。 |
| 关闭开机自启 | `sudo chkconfig [服务名] off` | 如 `sudo chkconfig mysqld off`。 |
| 查看服务自启状态 | `chkconfig --list [服务名]` | 显示服务在各运行级别的自启状态（如 `chkconfig --list httpd`）。 |
| 查看所有服务自启状态 | `chkconfig --list` | 列出所有服务在各运行级别的自启状态。 |


### 3. SysVinit 服务的启动脚本
SysVinit 通过 Shell 脚本管理服务，脚本默认路径为 `/etc/init.d/`（部分系统链接到 `/etc/rc.d/init.d/`），脚本名即服务名（如 `httpd`、`mysqld`）。

启动脚本的核心逻辑是接收 `start`、`stop`、`restart` 等参数，执行对应的命令。例如，`/etc/init.d/httpd` 的简化逻辑：

```bash
#!/bin/bash
case "$1" in
    start)
        echo "Starting httpd..."
        /usr/sbin/httpd  # 启动Apache
        ;;
    stop)
        echo "Stopping httpd..."
        killall httpd     # 停止Apache
        ;;
    restart)
        $0 stop
        $0 start
        ;;
    status)
        if pgrep httpd > /dev/null; then
            echo "httpd is running"
        else
            echo "httpd is stopped"
        fi
        ;;
    *)
        echo "Usage: $0 {start|stop|restart|status}"
        exit 1
        ;;
esac
```


## 四、常见服务示例与管理场景


### 1. 示例 1：管理 SSH 服务（远程登录）
+ **Systemd 系统**：
    - 启动：`sudo systemctl start sshd`
    - 开机自启：`sudo systemctl enable sshd`
    - 查看状态：`systemctl status sshd`（确认是否监听 22 端口）
+ **SysVinit 系统**：
    - 启动：`sudo service sshd start`
    - 开机自启：`sudo chkconfig sshd on`


### 2. 示例 2：管理 Nginx 服务（Web 服务器）
+ 修改 Nginx 配置文件后，重载配置（不中断服务）：
```bash
sudo systemctl reload nginx  # Systemd
sudo service nginx reload    # SysVinit
```

+ 查看 Nginx 日志（Systemd）：
```bash
sudo journalctl -u nginx -f  # 实时跟踪日志
```


### 3. 示例 3：自定义 Systemd 服务（以 Python 脚本为例）
假设需要将一个 Python 脚本（`/opt/my_script.py`）作为服务后台运行，步骤如下：

1. 创建服务配置文件 `/etc/systemd/system/my_script.service`：
```ini
[Unit]
Description=My Custom Python Script
After=network.target

[Service]
Type=simple
ExecStart=/usr/bin/python3 /opt/my_script.py  # Python路径+脚本路径
Restart=always  # 服务意外退出时自动重启（故障自愈）
User=www-data  # 以低权限用户运行（安全优化）

[Install]
WantedBy=multi-user.target
```

2. 加载配置并启动服务：
```bash
sudo systemctl daemon-reload  # 加载新配置
sudo systemctl start my_script  # 启动服务
sudo systemctl enable my_script  # 设置开机自启
systemctl status my_script  # 验证状态
```


## 五、关键区别：Systemd vs SysVinit

| **对比维度** | **Systemd** | **SysVinit** |
| :--- | :--- | :--- |
| 核心工具 | `systemctl` | `service` + `chkconfig` |
| 服务配置文件 | `.service` 单元文件（INI 格式） | Shell 脚本（`/etc/init.d/`） |
| 启动方式 | 并行启动（快） | 串行启动（慢） |
| 依赖管理 | 支持强依赖（Requires）、弱依赖（Wants） | 依赖需手动在脚本中定义（复杂） |
| 日志集成 | 内置 `journald`（`journalctl` 查看） | 依赖 `rsyslog`（日志存 `/var/log/`） |
| 运行级别 | 目标（Target）替代（如 `multi-user.target`） | 数字级别（0-6） |


## 六、总结
+ 现代 Linux 系统（CentOS 7+、Ubuntu 15.04+）优先使用 **Systemd**，核心命令是 `systemctl`，配置文件为 `.service` 单元文件，日志通过 `journalctl` 查看。
+ 旧系统（CentOS 6、Ubuntu 14.04）使用 **SysVinit**，核心命令是 `service` 和 `chkconfig`，配置依赖 `/etc/init.d/` 下的 Shell 脚本。
+ 管理服务的核心场景：启动 / 停止 / 重启、配置开机自启、查看状态与日志、处理依赖关系。掌握这些基础操作，即可应对 Linux 服务的日常运维需求。